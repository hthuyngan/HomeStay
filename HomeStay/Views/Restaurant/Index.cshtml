@model IEnumerable<HomeStay.Models.MenuCategory>

@{
    ViewData["Title"] = "Nhà Hàng";
    var specialItems = ViewBag.SpecialItems as List<HomeStay.Models.MenuItem>;
}

<!-- Page Title -->
<div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Nhà Hàng</h1>
        <nav class="breadcrumbs">
            <ol>
                <li><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
                <li class="current">Nhà Hàng</li>
            </ol>
        </nav>
    </div>
</div>






<!-- Restaurant Section -->
<section id="restaurant" class="restaurant section">
    <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="row g-5 align-items-center">
            <div class="col-lg-6" data-aos="fade-up">
                <div class="about-content">
                    <h2>Trải Nghiệm Ẩm Thực Độc Đáo</h2>
                    <p class="fst-italic">Chúng tôi tự hào mang đến cho bạn những món ăn đậm chất Việt Nam, được chế biến từ nguyên liệu tươi ngon và công thức truyền thống.</p>
                    <p>Với không gian ấm cúng và đội ngũ phục vụ chuyên nghiệp, nhà hàng của chúng tôi là nơi lý tưởng để bạn thưởng thức bữa ăn ngon cùng gia đình và bạn bè.</p>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="feature-item" data-aos="fade-up" data-aos-delay="150">
                                <i class="bi bi-award"></i>
                                <h4>Dịch Vụ Xuất Sắc</h4>
                                <p>Đội ngũ nhân viên nhiệt tình, chu đáo, sẵn sàng phục vụ 24/7.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-item" data-aos="fade-up" data-aos-delay="200">
                                <i class="bi bi-trophy"></i>
                                <h4>Chất Lượng Hàng Đầu</h4>
                                <p>Được công nhận bởi nhiều tạp chí ẩm thực uy tín trong nước.</p>
                            </div>
                        </div>
                    </div>

                    <div class="signature mt-4" data-aos="fade-up" data-aos-delay="250">
                        <p class="chef-name">Hoàng Thúy Ngân, Trưởng Bếp</p>
                        <img src="/img/kkk.jpg" alt="Chef Signature" class="img-fluid">
                    </div>
                </div>
            </div>

            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="300">
                <div class="about-gallery">
                    <div class="row g-3">
                        <div class="col-6">
                            <img src="/img/restaurant/showcase-3.webp" class="img-fluid rounded" alt="Restaurant Image">
                        </div>
                        <div class="col-6">
                            <img src="/img/restaurant/showcase-8.webp" class="img-fluid rounded" alt="Restaurant Image">
                        </div>
                        <div class="col-12 mt-3">
                            <div class="years-badge" style="bottom:420px; right:380px;">
                                <span class="number">18</span>
                                <span class="text">Năm Kinh Nghiệm</span>
                            </div>
                            <img src="/img/restaurant/showcase-6.webp" class="img-fluid rounded" alt="Restaurant Image">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Menu Section -->
<section id="menu" class="menu section">
    <div class="container section-title" data-aos="fade-up">
        <span class="description-title">Thực Đơn</span>
        <h2>Thực Đơn</h2>
        <p>Khám phá những món ăn đặc sắc được chế biến bởi đầu bếp chuyên nghiệp của chúng tôi</p>
    </div>

    <div class="container" data-aos="fade-up">
        <div class="isotope-layout" data-default-filter="*" data-layout="masonry" data-sort="original-order">

            <!-- Menu Filters -->
            <div class="menu-filters isotope-filters mb-5">
                <ul>
                    <li data-filter="*" class="filter-active">Tất Cả</li>
                    @foreach (var category in Model.OrderBy(c => c.DisplayOrder))
                    {
                        <li data-filter=".filter-@category.CategoryNameEn.ToLower().Replace(" ", "-")">
                            @category.CategoryName
                        </li>
                    }
                </ul>
            </div>

            <!-- Menu Container -->
            <div class="menu-container isotope-container row gy-4">
                @foreach (var category in Model.OrderBy(c => c.DisplayOrder))
                {
                    @foreach (var item in category.MenuItems.Where(m => !m.IsSpecial).OrderBy(m => m.DisplayOrder))
                    {
                        <div class="col-lg-6 isotope-item filter-@category.CategoryNameEn.ToLower().Replace(" ", "-")">
                            <div class="menu-item d-flex align-items-center gap-4">
                                @if (!string.IsNullOrEmpty(item.Image))
                                {
                                    <img src="@item.Image" alt="@item.Name" class="menu-img img-fluid rounded-3">
                                }
                                else
                                {
                                    <img src="~/assets/img/restaurant/default.webp" alt="@item.Name" class="menu-img img-fluid rounded-3">
                                }
                                <div class="menu-content">
                                    <h5>
                                        @item.Name
                                        @if (!string.IsNullOrEmpty(item.Tags))
                                        {
                                            var firstTag = item.TagList.FirstOrDefault();
                                            if (!string.IsNullOrEmpty(firstTag))
                                            {
                                                <span class="menu-tag">@firstTag</span>
                                            }
                                        }
                                    </h5>
                                    <p>@item.Description</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="price">@item.PriceFormatted</div>
                                        <button class="btn btn-order btn-sm" onclick="addToCart(@item.MenuItemId, '@item.Name', @item.Price)">
                                            <i class="bi bi-cart-plus"></i> Đặt món
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>

        <!-- Download Menu Button -->
        <div class="text-center mt-5" data-aos="fade-up">
            <a href="#" class="download-menu">
                <i class="bi bi-file-earmark-pdf"></i> Tải Thực Đơn Đầy Đủ
            </a>
        </div>

        <!-- Chef's Specials -->
        @if (specialItems != null && specialItems.Any())
        {
            <div class="col-12 mt-5" data-aos="fade-up">
                <div class="specials-badge">
                    <span><i class="bi bi-award"></i> Món Đặc Biệt Của Đầu Bếp</span>
                </div>
                <div class="specials-container">
                    <div class="row g-4">
                        @foreach (var special in specialItems)
                        {
                            <div class="col-md-6">
                                <div class="menu-item special-item">
                                    <div class="menu-item-img">
                                        @if (!string.IsNullOrEmpty(special.Image))
                                        {
                                            <img src="@special.Image" alt="@special.Name" class="img-fluid">
                                        }
                                        else
                                        {
                                            <img src="~/assets/img/restaurant/default.webp" alt="@special.Name" class="img-fluid">
                                        }
                                        <div class="menu-item-badges">
                                            <span class="badge-special">Đặc Biệt</span>
                                            @if (special.TagList.Any())
                                            {
                                                foreach (var tag in special.TagList.Take(2))
                                                {
                                                    var badgeClass = tag.ToLower() switch
                                                    {
                                                        "hải sản" => "badge-vegan",
                                                        "premium" => "badge-spicy",
                                                        "đặc biệt" => "badge-special",
                                                        _ => "badge-vegan"
                                                    };
                                                    <span class="@badgeClass">@tag</span>
                                                }
                                            }
                                        </div>
                                    </div>
                                    <div class="menu-item-content">
                                        <h4>@special.Name</h4>
                                        <p>@special.Description</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="menu-item-price">@special.PriceFormatted</div>
                                            <button class="btn btn-order" onclick="addToCart(@special.MenuItemId, '@special.Name', @special.Price)">
                                                <i class="bi bi-cart-plus"></i> Đặt món
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</section>

// Thay thế toàn bộ section Scripts bằng code này:
@section Scripts {
    <script>
        // Update cart count on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
        });

        // Add to cart function - Dùng Fetch thay vì jQuery
        function addToCart(menuItemId, name, price) {
            fetch('@Url.Action("AddToCart", "FoodOrder")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `menuItemId=${menuItemId}&quantity=1`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    showToast('success', data.message);
                    // Update cart count
                    document.getElementById('cartCount').textContent = data.cartCount;
                    // Animate cart button
                    const cartButton = document.getElementById('cartButton');
                    cartButton.classList.add('bounce');
                    setTimeout(() => cartButton.classList.remove('bounce'), 600);
                } else {
                    showToast('error', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', 'Có lỗi xảy ra. Vui lòng thử lại.');
            });
        }

        // Update cart count
        function updateCartCount() {
            fetch('@Url.Action("GetCartCount", "FoodOrder")')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('cartCount').textContent = data.count;
                })
                .catch(error => console.error('Error:', error));
        }

        // Show toast notification
        function showToast(type, message) {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : 'x-circle'}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Initialize AOS and Isotope
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 600,
                    easing: 'ease-in-out',
                    once: true,
                    mirror: false
                });
            }

            var menuContainer = document.querySelector('.menu-container');
            if (menuContainer && typeof Isotope !== 'undefined') {
                var iso = new Isotope(menuContainer, {
                    itemSelector: '.isotope-item',
                    layoutMode: 'masonry',
                    masonry: {
                        columnWidth: '.isotope-item'
                    }
                });

                var filterButtons = document.querySelectorAll('.isotope-filters li');
                filterButtons.forEach(function(button) {
                    button.addEventListener('click', function() {
                        filterButtons.forEach(function(btn) {
                            btn.classList.remove('filter-active');
                        });
                        this.classList.add('filter-active');

                        var filterValue = this.getAttribute('data-filter');
                        iso.arrange({
                            filter: filterValue
                        });
                    });
                });
            }
        });
    </script>
}